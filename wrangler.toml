# Cloudflare Workers configuration for new-api
# LLM API Gateway with D1 Database
name = "new-api"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# Static Assets configuration - Frontend embedded in Workers
# SPA mode: returns index.html for routes not matching static files
[assets]
directory = "./dist"
binding = "ASSETS"
not_found_handling = "single-page-application"

# D1 Database binding
# The database will be automatically created during one-click deployment
# Or create manually with: wrangler d1 create new-api-db
[[d1_databases]]
binding = "DB"
database_name = "new-api-db"
database_id = "ee3af1f2-433b-4a0a-8427-0019089190fe"
migrations_dir = "./migrations"

# Environment variables
# Secrets (set via wrangler secret or during deploy):
# - JWT_SECRET: JWT signing secret key (required)
# - RELAY_PROXY_URL: Render relay proxy URL for SSE streaming (optional)
# - RELAY_PROXY_KEY: Relay proxy authentication key (optional)

[vars]
ALLOWED_ORIGINS = "*"
TOKEN_EXPIRY_HOURS = "24"
RELAY_PROXY_URL = "https://llm-proxy-relay.onrender.com"
RELAY_PROXY_KEY = "aUrZqBdgQKKB2NTZTfeC1mfCK7Py1hN9DNYWyAw3YFs="
